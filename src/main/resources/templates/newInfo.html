<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>정보 수정</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
  <h1 class="mb-4">정보 수정</h1>

  <form id="update-form">
    <input type="hidden" id="user-id" th:value="${user.id}"> <!-- 사용자 ID를 숨김 필드에 포함 -->

    <div class="mb-3">
      <label for="username" class="form-label">사용자 이름</label>
      <input type="text" class="form-control" id="username" th:value="${user.username}" readonly>
    </div>

    <div class="mb-3">
      <label for="nickname" class="form-label">닉네임</label>
      <input type="text" class="form-control" id="nickname" th:value="${user.nickname}" required>
    </div>

    <div class="mb-3">
      <label for="email" class="form-label">이메일</label>
      <input type="email" class="form-control" id="email" th:value="${user.email}" readonly>
    </div>

    <div class="mb-3">
      <label for="password" class="form-label">비밀번호</label>
      <input type="password" class="form-control" id="password" placeholder="새 비밀번호를 입력하세요 (변경하지 않으려면 비워 두세요)">
    </div>

    <a href="/boards/list" class="btn btn-primary">목록</a>
    <button type="button" class="btn btn-primary" id="modify-btn">저장</button>
  </form>
</div>

<script>
  const modifyButton = document.getElementById('modify-btn');

  if (modifyButton) {
    modifyButton.addEventListener('click', event => {
      event.preventDefault();

      // 숨겨진 필드에서 사용자 ID를 가져옵니다.
      let userId = document.getElementById('user-id').value;
      let username = document.getElementById('username').value;


      fetch(`/users/${userId}`, {
        method: 'PUT',
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          nickname: document.getElementById('nickname').value,
          password: document.getElementById('password').value // 비밀번호는 변경할 경우에만 포함
        })
      })
              .then(response => {
                if (response.ok) {
                  alert('수정이 완료되었습니다.');
                  location.replace(`/users/${username}`); // 수정 후 사용자 정보 페이지로 리다이렉트
                } else {
                  throw new Error('Failed to update user');
                }
              })
              .catch(error => {
                console.error('Error:', error);
                alert('사용자 정보를 수정하는데 실패했습니다.');
              });
    });
  }
</script>

</body>
</html>
